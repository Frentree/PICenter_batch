<?xml version="1.0" encoding="EUC-KR"?>

<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"  "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="query">

	<select id="getPersonCount" resultClass="com.skyun.app.util.database.ibatis.vo.PersonalVo">
		SELECT
		A.TARGET_ID as target_id,
		MAX(DATE_FORMAT(A.REGDATE, '%Y.%m/%d' )) AS REGDATE,
		SUM(CASE WHEN INSTR(UPPER(B.DATA_TYPE), 'SOUTH KOREAN DRIVER LICENSE NUMBER') > 0 THEN B.MATCH_COUNT ELSE 0 END) AS driver,
		SUM(CASE WHEN INSTR(UPPER(B.DATA_TYPE), 'SOUTH
		KOREAN FOREIGNER NUMBER') > 0 THEN B.MATCH_COUNT ELSE 0 END) AS foreigner,
		SUM(CASE WHEN INSTR(UPPER(B.DATA_TYPE), 'SOUTH KOREAN PASSPORT') > 0 THEN B.MATCH_COUNT ELSE 0 END) AS passport,
		SUM(CASE
		WHEN INSTR(UPPER(B.DATA_TYPE), 'SOUTH KOREAN RRN') > 0 THEN B.MATCH_COUNT ELSE 0 END) AS rrn,
		SUM(CASE WHEN INSTR(UPPER(B.DATA_TYPE), 'ACCOUNT NUMBER') > 0 THEN B.MATCH_COUNT ELSE 0 END) AS
		account_num,
		(
		SUM(CASE WHEN INSTR(UPPER(B.DATA_TYPE), 'AMERICAN EXPRESS') > 0 THEN B.MATCH_COUNT ELSE 0 END)
		+ SUM(CASE WHEN INSTR(UPPER(B.DATA_TYPE), 'CHINA UNION PAY') > 0 THEN B.MATCH_COUNT ELSE 0 END)
		+ SUM(CASE WHEN INSTR(UPPER(B.DATA_TYPE), 'DINERS C:UB') > 0 THEN B.MATCH_COUNT ELSE 0 END)
		+ SUM(CASE WHEN INSTR(UPPER(B.DATA_TYPE), 'DISCOVER') > 0 THEN B.MATCH_COUNT ELSE 0 END)
		+ SUM(CASE WHEN INSTR(UPPER(B.DATA_TYPE), 'JCB') > 0 THEN B.MATCH_COUNT ELSE 0 END)
		+ SUM(CASE WHEN INSTR(UPPER(B.DATA_TYPE), 'LASER') > 0 THEN B.MATCH_COUNT ELSE 0 END)
		+ SUM(CASE WHEN INSTR(UPPER(B.DATA_TYPE), 'MAESTRO') > 0 THEN B.MATCH_COUNT ELSE 0 END)
		+ SUM(CASE WHEN INSTR(UPPER(B.DATA_TYPE), 'MASTERCARD') > 0 THEN B.MATCH_COUNT ELSE 0 END)
		+ SUM(CASE WHEN INSTR(UPPER(B.DATA_TYPE), 'PRIVATE LABEL CARD') > 0 THEN B.MATCH_COUNT ELSE 0 END)
		+ SUM(CASE WHEN INSTR(UPPER(B.DATA_TYPE), 'TROY') > 0 THEN B.MATCH_COUNT ELSE 0 END)
		+ SUM(CASE WHEN INSTR(UPPER(B.DATA_TYPE), 'VISA' ) > 0 THEN B.MATCH_COUNT ELSE 0 END)
		) AS card_num,
		(SUM(CASE WHEN INSTR(UPPER(B.DATA_TYPE), 'SOUTH KOREAN DRIVER LICENSE NUMBER') > 0 THEN B.MATCH_COUNT ELSE 0 END)
		+ SUM(CASE WHEN INSTR(UPPER(B.DATA_TYPE), 'SOUTH KOREAN FOREIGNER NUMBER') > 0 THEN B.MATCH_COUNT ELSE 0 END)
		+ SUM(CASE WHEN INSTR(UPPER(B.DATA_TYPE), 'SOUTH KOREAN PASSPORT') > 0 THEN B.MATCH_COUNT ELSE 0 END)
		+ SUM(CASE WHEN INSTR(UPPER(B.DATA_TYPE), 'SOUTH KOREAN RRN') > 0 THEN B.MATCH_COUNT ELSE 0 END)) AS TOTAL,
		SUM(B.MATCH_COUNT) AS TOTALS
		FROM PI_FIND A, PI_SUMMARY B
		WHERE B.OBJECT_ID = A.HASH_ID
		AND B.TARGET_ID = A.TARGET_ID
		AND B.GROUP_ID = A.GROUP_ID
		AND DATE_FORMAT(A.REGDATE, '%Y.%m/%d' )=CURDATE()- INTERVAL 0 DAY
		GROUP BY
		DATE_FORMAT(A.REGDATE, '%Y.%m.%d' ),A.TARGET_ID
		ORDER BY A.REGDATE
	</select>

	<select id="getPreCount" resultClass="com.skyun.app.util.database.ibatis.vo.pi_topcompVo">
		SELECT
		target_id,
		SUM(rrn) AS rrn,
		SUM(foreigner) AS foreigner,
		SUM(driver) AS driver,
		SUM(passport) AS passport,
		SUM(account_num) AS account_num,
		SUM(card_num) AS card_num,
		SUM(total) AS total
		FROM pi_topcomp
		WHERE date(regdate)=CURDATE()- INTERVAL 1 DAY
		GROUP BY target_id
	</select>

	<select id="getAgentDisconnectList" resultClass="com.skyun.app.util.database.ibatis.vo.EmailItemVo">
		SELECT
		agent_name,
		agent_connected_ip
		FROM pi_agents
		where agent_connected=0
	</select>

	<select id="getDelDataList" resultClass="com.skyun.app.util.database.ibatis.vo.pifindVo">
		SELECT hash_id,group_id,target_id FROM pi_find
		WHERE DATE_FORMAT(regdate, '%Y.%m.%d' ) != DATE_FORMAT(NOW(), '%Y.%m.%d' )
		AND deldate IS null

	</select>

	<!-- 승인 대기 -->
	<select id="getEmailMaster1" resultClass="com.skyun.app.util.database.ibatis.vo.eMasterVo">
		SELECT DPCG.OK_USER_NO               AS receiver,
			   OK_USR.USER_NAME              AS receiver_name,
		       ifnull(DPCG.USER_NO, ' ')     AS sender,
		       ifnull(USR.USER_NAME, ' ')    AS sender_name
		FROM PI_DATA_PROCESSING_CHARGE_GROUP AS DPCG,
		    PI_USER AS USR,
		   PI_USER AS OK_USR
		WHERE DPCG.APPROVAL_STATUS = 'W'
		AND DPCG.USER_NO = USR.USER_NO
		AND DPCG.OK_USER_NO = OK_USR.USER_NO
		AND DPCG.REGDATE > DATE_ADD(NOW(), INTERVAL -24 HOUR)
		GROUP BY DPCG.OK_USER_NO,
		DPCG.USER_NO
		ORDER BY DPCG.OK_USER_NO,
		DPCG.USER_NO
	</select>

	<!-- 승인 반려 -->
	<select id="getEmailMaster2" resultClass="com.skyun.app.util.database.ibatis.vo.eMasterVo">
			SELECT DPCG.OK_USER_NO    AS sender,
		          OK_USR.USER_NAME   AS sender_name,
		          ifnull(DPCG.USER_NO,' ')       AS receiver,
		          ifnull(USR.USER_NAME,' ')     AS receiver_name
		     FROM PI_DATA_PROCESSING_CHARGE_GROUP AS DPCG,
		          PI_USER                         AS USR,
		          PI_USER                         AS OK_USR
		    WHERE DPCG.APPROVAL_STATUS = 'D'
		      AND DPCG.USER_NO         = USR.USER_NO
		      AND DPCG.OK_USER_NO      = OK_USR.USER_NO
		      AND DPCG.OKDATE > DATE_ADD(NOW(), INTERVAL -24 HOUR)
		   GROUP BY DPCG.OK_USER_NO,
		            DPCG.USER_NO
		   ORDER BY DPCG.OK_USER_NO,
		            DPCG.USER_NO
	</select>


	<!-- 승인 완료 -->
	<select id="getEmailMaster3" resultClass="com.skyun.app.util.database.ibatis.vo.eMasterVo">
		SELECT DPCG.OK_USER_NO AS sender,
			OK_USR.USER_NAME AS sender_name,
			ifnull(DPCG.USER_NO,' ') AS receiver,
			ifnull(USR.USER_NAME, ' ') AS receiver_name
		FROM PI_DATA_PROCESSING_CHARGE_GROUP AS DPCG,
			PI_USER AS USR,
			PI_USER AS OK_USR
		WHERE DPCG.APPROVAL_STATUS = 'E'
		AND DPCG.USER_NO = USR.USER_NO
		AND DPCG.OK_USER_NO = OK_USR.USER_NO
		AND DPCG.OKDATE > DATE_ADD(NOW(), INTERVAL -24 HOUR)
		GROUP BY DPCG.OK_USER_NO,
		DPCG.USER_NO
		ORDER BY DPCG.OK_USER_NO,
		DPCG.USER_NO
	</select>

	<!-- 담당자 변경요청 -->
	<select id="getEmailMaster4" resultClass="com.skyun.app.util.database.ibatis.vo.eMasterVo">
		SELECT CU.REG_USER_NO AS receiver,
		USR.USER_NAME AS receiver_name,
		ifnull(CU.OK_USER_NO,' ') AS sender,
		ifnull(OK_USR.USER_NAME, ' ') AS sender_name
		FROM PI_CHARGE_UPDATE AS CU,
		PI_TARGETS AS T,
		PI_USER AS USR,
		PI_USER AS OK_USR
		WHERE T.TARGET_ID = CU.TARGET_ID
		AND (CU.APPROVAL_STATUS = 'W' OR CU.APPROVAL_STATUS IS NULL OR CU.APPROVAL_STATUS = '')
		AND CU.REG_USER_NO = USR.USER_NO
		AND CU.OK_USER_NO = OK_USR.USER_NO
		GROUP BY CU.REG_USER_NO,
		CU.OK_USER_NO
	</select>

	<!-- 담당자 변경반려 -->
	<select id="getEmailMaster5" resultClass="com.skyun.app.util.database.ibatis.vo.eMasterVo">

		SELECT ifnull(CU.OK_USER_NO, ' ') AS sender,
		ifnull(OK_USR.USER_NAME, ' ') AS sender_name,
		CU.REG_USER_NO AS receiver,
		USR.USER_NAME AS receiver_name
		FROM PI_CHARGE_UPDATE AS CU,
		PI_TARGETS AS T,
		PI_USER AS USR,
		PI_USER AS OK_USR
		WHERE T.TARGET_ID = CU.TARGET_ID
		AND CU.APPROVAL_STATUS = 'D'
		AND CU.OKDATE > DATE_ADD(NOW(), INTERVAL -24 HOUR)
		AND CU.REG_USER_NO = USR.USER_NO
		AND CU.OK_USER_NO = OK_USR.USER_NO
		GROUP BY CU.OK_USER_NO,
		CU.REG_USER_NO

	</select>


	<!-- 담당자 변경완료 -->
	<select id="getEmailMaster6" resultClass="com.skyun.app.util.database.ibatis.vo.eMasterVo">
		SELECT ifnull(CU.OK_USER_NO, ' ') AS sender,
		ifnull(OK_USR.USER_NAME, ' ') AS sender_name,
		CU.REG_USER_NO AS receiver,
		USR.USER_NAME AS receiver_name
		FROM PI_CHARGE_UPDATE AS CU,
		PI_TARGETS AS T,
		PI_USER AS USR,
		PI_USER AS OK_USR
		WHERE T.TARGET_ID = CU.TARGET_ID
		AND CU.APPROVAL_STATUS = 'E'
		AND CU.OKDATE > DATE_ADD(NOW(), INTERVAL -24 HOUR)
		AND CU.REG_USER_NO = USR.USER_NO
		AND CU.OK_USER_NO = OK_USR.USER_NO
		GROUP BY CU.OK_USER_NO, CU.REG_USER_NO

	</select>

	<select id="getEmailMaster7" resultClass="com.skyun.app.util.database.ibatis.vo.eMasterVo">

		SELECT USER_NO AS sender,
		USER_NAME AS sender_name,
		'' AS receiver,
		USER_NAME AS receiver_name
		FROM PI_USER

	</select>

	<select id="getEmailDetail1" parameterClass="com.skyun.app.util.database.ibatis.vo.eMasterVo" resultClass="com.skyun.app.util.database.ibatis.vo.eDetail1Vo">
			 SELECT DPCG.data_processing_charge_name AS PATH,
		      USR.USER_NAME                    AS REQ_USER_NAME,
		      OK_USR.USER_NAME                 AS OK_USER_NAME,
		      DATE_FORMAT(DPCG.REGDATE, '%Y-%m-%d %H:%i:%s') AS REGDATE,
		      ifnull(DATE_FORMAT(DPCG.OKDATE, '%Y-%m-%d %H:%i:%s'), ' ') AS OKDATE,
		      '승인 대기'                         AS STATUS_NAME,
		      ifnull(DPCG.REASON  ,' ')        AS REASON
		 FROM PI_DATA_PROCESSING_CHARGE_GROUP AS DPCG,
		      PI_USER AS USR,
		      PI_USER AS OK_USR
		WHERE DPCG.APPROVAL_STATUS = 'W'
		  AND DPCG.OK_USER_NO      = #receiver#
		AND DPCG.USER_NO         = #sender#
		AND DPCG.REGDATE > DATE_ADD(NOW(), INTERVAL -24 HOUR)
		  AND DPCG.USER_NO         = USR.USER_NO
		  AND DPCG.OK_USER_NO      = OK_USR.USER_NO
		ORDER BY DPCG.REGDATE DESC,
		        DPCG.OKDATE DESC
	</select>

	<select id="getEmailDetail2" parameterClass="com.skyun.app.util.database.ibatis.vo.eMasterVo" resultClass="com.skyun.app.util.database.ibatis.vo.eDetail2Vo">

		SELECT DPCG.data_processing_charge_name AS PATH,
		USR.USER_NAME AS REQ_USER_NAME,
		OK_USR.USER_NAME AS OK_USER_NAME,
		DATE_FORMAT(DPCG.REGDATE, '%Y-%m-%d %H:%i:%s') AS REGDATE,
		ifnull(DATE_FORMAT(DPCG.OKDATE, '%Y-%m-%d %H:%i:%s'), ' ') AS OKDATE,
		'승인 반려' AS STATUS_NAME,
		ifnull(DPCG.REASON ,' ') AS REASON
		FROM PI_DATA_PROCESSING_CHARGE_GROUP AS DPCG,
		PI_USER AS USR,
		PI_USER AS OK_USR
		WHERE DPCG.APPROVAL_STATUS = 'D'
		AND DPCG.OK_USER_NO = #sender#
		AND DPCG.USER_NO = #receiver#
		AND DPCG.OKDATE > DATE_ADD(NOW(), INTERVAL -24 HOUR)
		AND DPCG.USER_NO = USR.USER_NO
		AND DPCG.OK_USER_NO = OK_USR.USER_NO
		ORDER BY DPCG.REGDATE DESC,
		DPCG.OKDATE DESC;

	</select>

	<select id="getEmailDetail3" parameterClass="com.skyun.app.util.database.ibatis.vo.eMasterVo" resultClass="com.skyun.app.util.database.ibatis.vo.eDetail3Vo">
		SELECT DPCG.data_processing_charge_name AS PATH,
		USR.USER_NAME AS REQ_USER_NAME,
		OK_USR.USER_NAME AS OK_USER_NAME,
		DATE_FORMAT(DPCG.REGDATE, '%Y-%m-%d %H:%i:%s') AS REGDATE,
		ifnull(DATE_FORMAT(DPCG.OKDATE, '%Y-%m-%d %H:%i:%s'), ' ') AS OKDATE,
		'승인 완료' AS STATUS_NAME,
		ifnull(DPCG.REASON ,' ') AS REASON
		FROM PI_DATA_PROCESSING_CHARGE_GROUP AS DPCG,
		PI_USER AS USR,
		PI_USER AS OK_USR
		WHERE DPCG.APPROVAL_STATUS = 'E'
		AND DPCG.OK_USER_NO = #sender#
		AND DPCG.USER_NO = #receiver#
		AND DPCG.OKDATE > DATE_ADD(NOW(), INTERVAL -24 HOUR)
		AND DPCG.USER_NO = USR.USER_NO
		AND DPCG.OK_USER_NO = OK_USR.USER_NO
		ORDER BY DPCG.REGDATE DESC, DPCG.OKDATE DESC
	</select>
	<select id="getEmailDetail4" parameterClass="com.skyun.app.util.database.ibatis.vo.eMasterVo" resultClass="com.skyun.app.util.database.ibatis.vo.eDetail4Vo">
		SELECT T.NAME AS HOST,
		CU.PATH AS PATH,
		(SELECT Z.USER_NAME FROM PI_USER Z WHERE Z.USER_NO = CU.REG_USER_NO) AS REG_USER_NAME,
		(SELECT Z.USER_NAME FROM PI_USER Z WHERE Z.USER_NO = CU.OK_USER_NO) AS OK_USER_NAME,
		DATE_FORMAT(CU.REGDATE, '%Y-%m-%d %H:%i:%s') AS REGDATE,
		ifnull(DATE_FORMAT(CU.OKDATE, '%Y-%m-%d %H:%i:%s'),' ') AS OKDATE,
		'승인대기' AS STATUS_NAME,
		ifnull(CU.REASON ,' ') AS REASON,
		ifnull(CU.REG_USER_NO ,' ') AS REG_USER_NO,
		ifnull(CU.OK_USER_NO ,' ') AS OK_USER_NO
		FROM PI_CHARGE_UPDATE AS CU,
		PI_TARGETS AS T
		WHERE T.TARGET_ID = CU.TARGET_ID
		AND (CU.APPROVAL_STATUS = 'W' OR CU.APPROVAL_STATUS IS NULL OR CU.APPROVAL_STATUS = '')
		AND CU.REG_USER_NO = #sender#
		AND CU.OK_USER_NO = #receiver#
		ORDER BY CU.REGDATE DESC, CU.OKDATE DESC
	</select>


	<select id="getEmailDetail5" parameterClass="com.skyun.app.util.database.ibatis.vo.eMasterVo" resultClass="com.skyun.app.util.database.ibatis.vo.eDetail5Vo">
		SELECT T.NAME AS HOST,
		CU.PATH AS PATH,
		(SELECT Z.USER_NAME FROM PI_USER Z WHERE Z.USER_NO = CU.REG_USER_NO) AS REG_USER_NAME,
		(SELECT Z.USER_NAME FROM PI_USER Z WHERE Z.USER_NO = CU.OK_USER_NO) AS OK_USER_NAME,
		DATE_FORMAT(CU.REGDATE, '%Y-%m-%d %H:%i:%s') AS REGDATE,
		ifnull(DATE_FORMAT(CU.OKDATE, '%Y-%m-%d %H:%i:%s'),' ') AS OKDATE,
		'반려' AS STATUS_NAME,
		ifnull( CU.REASON ,' ') AS REASON,
		ifnull( CU.REG_USER_NO ,' ') AS REG_USER_NO,
		ifnull(CU.OK_USER_NO ,' ') AS OK_USER_NO
		FROM PI_CHARGE_UPDATE AS CU,
		PI_TARGETS AS T
		WHERE T.TARGET_ID = CU.TARGET_ID
		AND CU.APPROVAL_STATUS = 'D'
		AND CU.OKDATE > DATE_ADD(NOW(), INTERVAL -24 HOUR)
		AND CU.OK_USER_NO = #sender#
		AND CU.REG_USER_NO = #receiver#
		ORDER BY CU.REGDATE DESC, CU.OKDATE DESC
	</select>

	<select id="getEmailDetail6" parameterClass="com.skyun.app.util.database.ibatis.vo.eMasterVo" resultClass="com.skyun.app.util.database.ibatis.vo.eDetail6Vo">
		SELECT T.NAME AS HOST,
		CU.PATH AS PATH,
		(SELECT Z.USER_NAME FROM PI_USER Z WHERE Z.USER_NO = CU.REG_USER_NO) AS REG_USER_NAME,
		(SELECT Z.USER_NAME FROM PI_USER Z WHERE Z.USER_NO = CU.OK_USER_NO) AS OK_USER_NAME,
		DATE_FORMAT(CU.REGDATE, '%Y-%m-%d %H:%i:%s') AS REGDATE,
		ifnull(DATE_FORMAT(CU.OKDATE, '%Y-%m-%d %H:%i:%s'), ' ') AS OKDATE,
		'승인완료' AS STATUS_NAME,
		ifnull( CU.REASON ,' ') AS REASON,
		ifnull( CU.REG_USER_NO ,' ') AS REG_USER_NO,
		ifnull(CU.OK_USER_NO ,' ') AS OK_USER_NO
		FROM PI_CHARGE_UPDATE AS CU,
		PI_TARGETS AS T
		WHERE T.TARGET_ID = CU.TARGET_ID
		AND CU.APPROVAL_STATUS = 'E'
		AND CU.OKDATE > DATE_ADD(NOW(), INTERVAL -24 HOUR)
		AND CU.OK_USER_NO = #sender#
		AND CU.REG_USER_NO = #receiver#
		ORDER BY CU.REGDATE DESC, CU.OKDATE DESC
	</select>

	<select id="getEmailDetail7" parameterClass="com.skyun.app.util.database.ibatis.vo.eMasterVo" resultClass="com.skyun.app.util.database.ibatis.vo.eDetail7Vo">
		WITH RECURSIVE CTE AS (
		SELECT C.GROUP_ID AS GID,
		C.TARGET_ID AS PID,
		C.HASH_ID AS ID,
		C.HASH_ID AS CID,
		C.TARGET_ID AS TID,
		CONCAT((CASE WHEN IFNULL(PRC_FLAG.PROCESSING_FLAG,'') = '' THEN '0' ELSE 'Z' END), C.PATH) AS NAME,
		C.PATH AS SHORTNAME,
		C.PATH AS PATH,
		1 AS LEVEL,
		T.NAME AS HOST,
		C.OWNER AS OWNER,
		PRC.APPROVAL_STATUS AS APPROVAL_STATUS,
		PRC.APPROVAL_STATUS AS LINK_APPROVAL_STATUS,
		PRC_FLAG.PROCESSING_FLAG AS PROCESSING_FLAG,
		PRC_FLAG.PROCESSING_FLAG AS LINK_PROCESSING_FLAG,
		PRC_FLAG.PROCESSING_FLAG_NAME AS PROCESSING_FLAG_NAME,
		(CASE WHEN PRC_FLAG.PROCESSING_FLAG IS NULL THEN ''
		ELSE CONCAT((CASE WHEN PRC.APPROVAL_STATUS = 'W' THEN '처리 등록'
		WHEN PRC.APPROVAL_STATUS = 'E' THEN '처리 완료'
		WHEN PRC.APPROVAL_STATUS = 'D' THEN '처리 반려'
		ELSE '처리 대기' END ), '_', PRC_FLAG.PROCESSING_FLAG_NAME) END) AS APPROVAL_STATUS_PRINT_NAME
		FROM PI_TARGETS T
		LEFT OUTER JOIN PI_FIND C ON T.GROUP_ID = C.GROUP_ID AND T.TARGET_ID = C.TARGET_ID
		LEFT OUTER JOIN PI_DATA_PROCESSING PRC ON PRC.TARGET_ID = C.TARGET_ID AND C.GROUP_ID = PRC.GROUP_ID AND C.HASH_ID = PRC.HASH_ID
		LEFT OUTER JOIN PI_DATA_PROCESSING_FLAG PRC_FLAG ON PRC.PROCESSING_FLAG = PRC_FLAG.PROCESSING_FLAG
		WHERE T.TARGET_ID IN (SELECT T.TARGET_ID FROM PI_TARGETS T, PI_AGENTS A, PI_TARGET_USER U WHERE T.NAME = A.AGENT_NAME AND U.TARGET_ID = T.TARGET_ID AND U.USER_NO = #sender#)
		AND C.OWNER = #sender#
		UNION ALL
		SELECT C.GROUP_ID AS GID,
		C.PARENT_ID AS PID,
		C.NODE_ID AS ID,
		CTE.CID AS CID,
		C.TARGET_ID AS TID,
		CONCAT(CTE.NAME , '>' , C.PATH) AS NAME,
		C.PATH AS SHORTNAME,
		CONCAT(CTE.PATH , '>' , C.NODE_ID) AS PATH,
		CTE.LEVEL + 1 AS LEVEL,
		T.NAME AS HOST,
		C.OWNER AS OWNER,
		'' AS APPROVAL_STATUS,
		CTE.LINK_APPROVAL_STATUS AS LINK_APPROVAL_STATUS,
		'' AS PROCESSING_FLAG,
		CTE.LINK_PROCESSING_FLAG AS LINK_PROCESSING_FLAG,
		'' AS PROCESSING_FLAG_NAME,
		'' AS APPROVAL_STATUS_PRINT_NAME
		FROM PI_SUBPATH C, CTE, PI_TARGETS T
		WHERE C.TARGET_ID = CTE.TID
		AND C.PARENT_ID = CTE.ID
		AND C.GROUP_ID = CTE.GID
		AND C.GROUP_ID = T.GROUP_ID
		AND C.TARGET_ID = T.TARGET_ID
		)
		SELECT CTE.SHORTNAME AS SHORTNAME,
		CTE.HOST AS HOST,
		CTE.OWNER AS OWNER,
		SUM(CASE WHEN INSTR(UPPER(SUMM.DATA_TYPE), 'SOUTH KOREAN RRN') > 0 THEN SUMM.MATCH_COUNT ELSE 0 END) AS TYPE1,
		SUM(CASE WHEN INSTR(UPPER(SUMM.DATA_TYPE), 'SOUTH KOREAN FOREIGNER NUMBER') > 0 THEN SUMM.MATCH_COUNT ELSE 0 END) AS TYPE2,
		SUM(CASE WHEN INSTR(UPPER(SUMM.DATA_TYPE), 'SOUTH KOREAN PASSPORT') > 0 THEN SUMM.MATCH_COUNT ELSE 0 END) AS TYPE3,
		SUM(CASE WHEN INSTR(UPPER(SUMM.DATA_TYPE), 'SOUTH KOREAN DRIVER LICENSE NUMBER') > 0 THEN SUMM.MATCH_COUNT ELSE 0 END) AS TYPE4,
		SUM(CASE WHEN INSTR(UPPER(SUMM.DATA_TYPE), 'ACCOUNT NUMBER') > 0 THEN SUMM.MATCH_COUNT ELSE 0 END) AS TYPE5,
		(SUM(CASE WHEN INSTR(UPPER(SUMM.DATA_TYPE), 'VISA') > 0 THEN SUMM.MATCH_COUNT ELSE 0 END) +
		SUM(CASE WHEN INSTR(UPPER(SUMM.DATA_TYPE), 'MAESTRO') > 0 THEN SUMM.MATCH_COUNT ELSE 0 END) +
		SUM(CASE WHEN INSTR(UPPER(SUMM.DATA_TYPE), 'PRIVATE LABEL CARD') > 0 THEN SUMM.MATCH_COUNT ELSE 0 END) +
		SUM(CASE WHEN INSTR(UPPER(SUMM.DATA_TYPE), 'DINERS CLUB') > 0 THEN SUMM.MATCH_COUNT ELSE 0 END) +
		SUM(CASE WHEN INSTR(UPPER(SUMM.DATA_TYPE), 'JCB') > 0 THEN SUMM.MATCH_COUNT ELSE 0 END) +
		SUM(CASE WHEN INSTR(UPPER(SUMM.DATA_TYPE), 'LASER') > 0 THEN SUMM.MATCH_COUNT ELSE 0 END) +
		SUM(CASE WHEN INSTR(UPPER(SUMM.DATA_TYPE), 'MASTERCARD') > 0 THEN SUMM.MATCH_COUNT ELSE 0 END) +
		SUM(CASE WHEN INSTR(UPPER(SUMM.DATA_TYPE), 'AMERICAN EXPRESS') > 0 THEN SUMM.MATCH_COUNT ELSE 0 END) ) AS TYPE6,
		( SUM(CASE WHEN INSTR(UPPER(SUMM.DATA_TYPE), 'SOUTH KOREAN DRIVER LICENSE NUMBER') > 0 THEN SUMM.MATCH_COUNT ELSE 0 END) +
		SUM(CASE WHEN INSTR(UPPER(SUMM.DATA_TYPE), 'SOUTH KOREAN FOREIGNER NUMBER') > 0 THEN SUMM.MATCH_COUNT ELSE 0 END) +
		SUM(CASE WHEN INSTR(UPPER(SUMM.DATA_TYPE), 'SOUTH KOREAN PASSPORT') > 0 THEN SUMM.MATCH_COUNT ELSE 0 END) +
		SUM(CASE WHEN INSTR(UPPER(SUMM.DATA_TYPE), 'SOUTH KOREAN RRN') > 0 THEN SUMM.MATCH_COUNT ELSE 0 END) +
		SUM(CASE WHEN INSTR(UPPER(SUMM.DATA_TYPE), 'ACCOUNT NUMBER') > 0 THEN SUMM.MATCH_COUNT ELSE 0 END) +
		(SUM(CASE WHEN INSTR(UPPER(SUMM.DATA_TYPE), 'VISA') > 0 THEN SUMM.MATCH_COUNT ELSE 0 END) +
		SUM(CASE WHEN INSTR(UPPER(SUMM.DATA_TYPE), 'MAESTRO') > 0 THEN SUMM.MATCH_COUNT ELSE 0 END) +
		SUM(CASE WHEN INSTR(UPPER(SUMM.DATA_TYPE), 'PRIVATE LABEL CARD') > 0 THEN SUMM.MATCH_COUNT ELSE 0 END) +
		SUM(CASE WHEN INSTR(UPPER(SUMM.DATA_TYPE), 'DINERS CLUB') > 0 THEN SUMM.MATCH_COUNT ELSE 0 END) +
		SUM(CASE WHEN INSTR(UPPER(SUMM.DATA_TYPE), 'JCB') > 0 THEN SUMM.MATCH_COUNT ELSE 0 END) +
		SUM(CASE WHEN INSTR(UPPER(SUMM.DATA_TYPE), 'LASER') > 0 THEN SUMM.MATCH_COUNT ELSE 0 END) +
		SUM(CASE WHEN INSTR(UPPER(SUMM.DATA_TYPE), 'MASTERCARD') > 0 THEN SUMM.MATCH_COUNT ELSE 0 END) +
		SUM(CASE WHEN INSTR(UPPER(SUMM.DATA_TYPE), 'AMERICAN EXPRESS') > 0 THEN SUMM.MATCH_COUNT ELSE 0 END)) ) AS TYPE,
		CTE.APPROVAL_STATUS_PRINT_NAME
		FROM CTE LEFT OUTER JOIN PI_SUMMARY SUMM USE INDEX (PRIMARY) ON SUMM.TARGET_ID = CTE.TID AND SUMM.OBJECT_ID = CTE.ID AND SUMM.GROUP_ID = CTE.GID
		WHERE 1 = 1
		AND (CASE WHEN IFNULL(CTE.LINK_PROCESSING_FLAG,999) = 5 AND IFNULL(CTE.LINK_APPROVAL_STATUS,'D') = 'E' THEN 'X' ELSE 'O' END) = 'O'
		AND CTE.LEVEL = 1
		GROUP BY CTE.PID, CTE.ID, CTE.NAME, CTE.SHORTNAME, CTE.PATH, CTE.HOST, CTE.LEVEL
		ORDER BY CTE.HOST, CTE.NAME
	</select>


</sqlMap>
